<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ðŸŽ¬ Movie Post Generator</title>
<link rel="stylesheet" href="https://tituhh.github.io/css/cdn/gen.css">
<style>
body {
  background: #121212;
  color: white;
  font-family: 'Poppins', sans-serif;
  text-align: center;
  padding: 20px;
}
input, textarea {
  width: 90%;
  padding: 10px;
  margin: 8px 0;
  border-radius: 6px;
  border: none;
  outline: none;
  font-size: 14px;
}
button {
  background: cyan;
  color: #000;
  border: none;
  padding: 10px 15px;
  border-radius: 5px;
  font-weight: 600;
  cursor: pointer;
  margin: 10px;
}
button:hover { background: #00e0e0; }

#downloads input {
  width: 45%;
  display: inline-block;
}
#downloads div {
  margin-bottom: 10px;
}
.output-box {
  background: #1a1a1a;
  padding: 15px;
  border-radius: 10px;
  text-align: left;
  margin-top: 20px;
}
</style>
</head>
<body>

<h2>ðŸŽ¥ TMDB Movie Post Generator</h2>
<input type="text" id="tmdbId" placeholder="Enter TMDB ID (e.g., 414906)">
<button onclick="fetchData()">Fetch Movie</button>

<div id="form-section" style="display:none;">
  <input type="text" id="title" placeholder="Title">
  <input type="text" id="tagline" placeholder="Tagline">
  <input type="text" id="poster" placeholder="Poster URL">
  <textarea id="overview" placeholder="Overview"></textarea>
  <input type="text" id="genres" placeholder="Genres (comma separated)">
  <input type="text" id="release" placeholder="Release Date">
  <input type="text" id="runtime" placeholder="Runtime">
  <input type="text" id="director" placeholder="Director">
  <input type="text" id="writer" placeholder="Writer">
  <input type="text" id="cast" placeholder="Top 5 Cast">

  <h3>â¬‡ Download Buttons</h3>
  <div id="downloads">
    <div>
      <input type="text" placeholder="Button Label" class="btn-label">
      <input type="text" placeholder="Button URL" class="btn-url">
    </div>
  </div>
  <button onclick="addDownload()">âž• Add More</button>

  <button onclick="generateHTML()">Generate HTML</button>
</div>

<div class="output-box">
  <h3>Generated HTML</h3>
  <textarea id="output" rows="20"></textarea>
  <button onclick="sendEmail()">Send via Mail</button>
</div>

<script>
async function fetchData() {
  const id = document.getElementById("tmdbId").value.trim();
  if (!id) return alert("Enter TMDB ID");
  const apiKey = "55b11132b5aef36e8376418dcce756f2";
  const res = await fetch(`https://api.themoviedb.org/3/movie/${id}?api_key=${apiKey}&append_to_response=credits,images`);
  const data = await res.json();
  
  document.getElementById("form-section").style.display = "block";
  document.getElementById("title").value = data.title || "";
  document.getElementById("tagline").value = data.tagline || "";
  document.getElementById("poster").value = "https://image.tmdb.org/t/p/w500" + data.poster_path;
  document.getElementById("overview").value = data.overview || "";
  document.getElementById("genres").value = data.genres.map(g => g.name).join(", ");
  document.getElementById("release").value = data.release_date || "";
  document.getElementById("runtime").value = data.runtime ? data.runtime + " min" : "";
  const crew = data.credits.crew;
  document.getElementById("director").value = crew.find(c => c.job === "Director")?.name || "";
  document.getElementById("writer").value = crew.filter(c => c.department === "Writing").map(c => c.name).slice(0,2).join(", ");
  document.getElementById("cast").value = data.credits.cast.slice(0,5).map(c => c.name).join(", ");
}

function addDownload() {
  const div = document.createElement("div");
  div.innerHTML = `
    <input type="text" placeholder="Button Label" class="btn-label">
    <input type="text" placeholder="Button URL" class="btn-url">
  `;
  document.getElementById("downloads").appendChild(div);
}

function generateHTML() {
  const title = document.getElementById("title").value;
  const tagline = document.getElementById("tagline").value;
  const poster = document.getElementById("poster").value;
  const overview = document.getElementById("overview").value;
  const genres = document.getElementById("genres").value.split(",").map(g => g.trim());
  const release = document.getElementById("release").value;
  const runtime = document.getElementById("runtime").value;
  const director = document.getElementById("director").value;
  const writer = document.getElementById("writer").value;
  const cast = document.getElementById("cast").value;
  const downloads = Array.from(document.querySelectorAll("#downloads div")).map(div => ({
    label: div.querySelector(".btn-label").value,
    url: div.querySelector(".btn-url").value
  }));

  const html = `
<link rel="stylesheet" href="https://tituhh.github.io/css/cdn/gen.css">
<div class="container">
  <div class="poster"><img src="${poster}" alt="Poster"></div>
  <h1 class="title">${title}</h1>
  <p class="tagline">${tagline}</p>
  <div class="genres">
    ${genres.map(g => `<a href="/search/label/${g}">${g}</a>`).join(" ")}
  </div>
  <div class="info-grid">
    <div><span class="label">Release Date:</span> <span class="value">${release}</span></div>
    <div><span class="label">Runtime:</span> <span class="value">${runtime}</span></div>
    <div><span class="label">Director:</span> <span class="value">${director}</span></div>
    <div><span class="label">Writer:</span> <span class="value">${writer}</span></div>
    <div><span class="label">Top Cast:</span> <span class="value">${cast}</span></div>
  </div>
  <div class="overview"><span class="label">Overview:</span><p>${overview}</p></div>
  ${downloads.map(d => `<a href="${d.url}" class="download-btn">â¬‡ ${d.label}</a>`).join("<br>")}
</div>`;
  
  document.getElementById("output").value = html;
}

async function sendEmail() {
  const htmlContent = document.getElementById("output").value;
  const response = await fetch("/api/sendPost", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ html: htmlContent })
  });
  const result = await response.json();
  alert(result.message);
}
</script>

</body>
</html>
