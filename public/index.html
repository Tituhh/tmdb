<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>🎬 TMDB Blogger Post Generator</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<style>
body {
  font-family: 'Poppins', sans-serif;
  background: radial-gradient(circle at top left, #0e0e0e, #1c1c1c);
  color: #fff;
  padding: 25px;
}
.container {
  max-width: 800px;
  margin: auto;
  background: rgba(255,255,255,0.05);
  padding: 25px;
  border-radius: 12px;
  backdrop-filter: blur(8px);
}
input, textarea {
  width: 100%;
  background: rgba(255,255,255,0.1);
  border: 1px solid #333;
  color: #fff;
  padding: 10px;
  border-radius: 8px;
  margin-bottom: 10px;
}
button {
  background: linear-gradient(90deg, #ff5733, #ff9800);
  border: none;
  color: #fff;
  padding: 10px 15px;
  border-radius: 6px;
  cursor: pointer;
  margin-right: 5px;
}
#screenshots img {
  width: 18%;
  margin: 1%;
  border-radius: 8px;
}
</style>
</head>
<body>
<div class="container">
<h2>🎬 TMDB Blogger Post Generator</h2>

<label>🔗 API Link (with token)</label>
<input id="apiLink" placeholder="https://tmdb-six-mauve.vercel.app/api/fetch?token=XXXX" onblur="checkApiStatus()">
<p id="apiStatus">🔴 Not Connected</p>

<label>🎥 Movie Name or TMDB ID</label>
<input id="movieInput" placeholder="e.g., Kantara or 505642">

<button onclick="fetchData()">🔍 Fetch Data</button>

<h3>📜 Movie Details</h3>
<input id="title" placeholder="Title">
<input id="genre" placeholder="Genre">
<input id="runtime" placeholder="Runtime (min)">
<input id="rating" placeholder="IMDb Rating">
<input id="releaseDate" placeholder="Release Date">
<textarea id="overview" rows="4" placeholder="Overview"></textarea>
<img id="poster" style="width:100%;border-radius:10px;margin:10px 0;">

<h4>🖼️ Screenshots</h4>
<div id="screenshots"></div>

<label>📩 Receiver Blogger Email</label>
<input id="receiver" placeholder="Enter receiver email">

<button onclick="generateHTML()">🧩 Generate HTML</button>
<button onclick="copyHTML()">📋 Copy HTML</button>
<button onclick="sendMail()">📧 Send via Email</button>

<textarea id="output" rows="8" placeholder="Generated HTML will appear here"></textarea>
</div>

<script>
async function checkApiStatus() {
  const link = document.getElementById('apiLink').value.trim();
  const status = document.getElementById('apiStatus');
  if (!link) return status.innerHTML = '🔴 Not Connected';
  try {
    const res = await fetch(link + '&query=test');
    if (res.ok) status.innerHTML = '🟢 Live';
    else status.innerHTML = '🔴 Not Connected';
  } catch {
    status.innerHTML = '🔴 Not Connected';
  }
}

async function fetchData() {
  const api = document.getElementById('apiLink').value.trim();
  const query = document.getElementById('movieInput').value.trim();
  const res = await fetch(`${api}&query=${encodeURIComponent(query)}`);
  const data = await res.json();
  document.getElementById('title').value = data.title;
  document.getElementById('genre').value = data.genres.map(g => g.name).join(', ');
  document.getElementById('runtime').value = data.runtime;
  document.getElementById('rating').value = data.vote_average;
  document.getElementById('releaseDate').value = data.release_date;
  document.getElementById('overview').value = data.overview;
  document.getElementById('poster').src = `https://image.tmdb.org/t/p/w500${data.poster_path}`;
  const ss = document.getElementById('screenshots');
  ss.innerHTML = '';
  for (let i = 0; i < 5; i++)
    ss.innerHTML += `<img src="https://via.placeholder.com/150x100?text=Screenshot+${i+1}" />`;
}

function generateHTML() {
  const t = document.getElementById;
  const html = `
<div style="background:#0e0e0e;color:#fff;padding:20px;border-radius:12px;font-family:'Poppins',sans-serif;max-width:700px;margin:auto;line-height:1.6;">
<img src="${t('poster').src}" style="width:100%;border-radius:12px;margin-bottom:15px;">
<h2 style="color:#ff5733;text-align:center;">🎬 ${t('title').value} (${t('releaseDate').value})</h2>
<p><b>Genre:</b> ${t('genre').value}</p>
<p><b>Runtime:</b> ${t('runtime').value} min</p>
<p><b>IMDb:</b> ${t('rating').value}</p>
<p>${t('overview').value}</p>
</div>`;
  document.getElementById('output').value = html;
}

function copyHTML() {
  const text = document.getElementById('output');
  text.select();
  document.execCommand('copy');
  Swal.fire("Copied!", "HTML copied to clipboard.", "success");
}

async function sendMail() {
  const title = document.getElementById('title').value;
  const html = document.getElementById('output').value;
  const receiver = document.getElementById('receiver').value;

  const res = await fetch('/api/send_email', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ title, html, receiver })
  });
  const data = await res.json();
  Swal.fire("Mail Sent!", JSON.stringify(data), "success");
}
</script>
</body>
</html>