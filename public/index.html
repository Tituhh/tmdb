<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TMDB Post Generator</title>
  <link rel="stylesheet" href="https://tituhh.github.io/css/cdn/gen.css">
  <style>
    body { background: #121212; color: #fff; font-family: 'Poppins', sans-serif; }
    .container { max-width: 900px; margin: auto; padding: 20px; text-align: center; }
    input, textarea { width: 100%; padding: 8px; margin: 6px 0; border-radius: 8px; border: none; background: #1e1e1e; color: #fff; }
    button { background: cyan; border: none; padding: 10px 20px; border-radius: 6px; margin-top: 10px; cursor: pointer; font-weight: 600; }
    #output { margin-top: 30px; text-align: left; background: #1a1a1a; padding: 20px; border-radius: 10px; }
  </style>
</head>
<body>

<div class="container">
  <h2>üé¨ TMDB Post Generator</h2>

  <input id="tmdbid" placeholder="Enter TMDB ID (e.g. 414906)" />
  <button onclick="fetchData()">Fetch Data</button>

  <input id="title-field" placeholder="Title" />
  <input id="tagline-field" placeholder="Tagline" />
  <input id="poster-field" placeholder="Poster URL" />
  <input id="backdrop-field" placeholder="Backdrop URL" />
  <input id="genres-field" placeholder="Genres (comma separated)" />
  <input id="release-field" placeholder="Release Date" />
  <input id="runtime-field" placeholder="Runtime (min)" />
  <input id="director-field" placeholder="Director" />
  <input id="writer-field" placeholder="Writer" />
  <input id="cast-field" placeholder="Top Cast (comma separated)" />
  <textarea id="overview-field" placeholder="Overview"></textarea>
  <input id="screenshots-field" placeholder="Screenshots URLs (comma separated)" />
  <input id="download-label-field" placeholder="Download Label" />
  <input id="download-link-field" placeholder="Download Link" />

  <button onclick="generateHTML()">Generate HTML</button>

  <div id="output"></div>

  <button onclick="sendToBlogger()">Send to Blogger</button>
</div>

<script>
const TMDB_API_KEY = "55b11132b5aef36e8376418dcce756f2";

async function fetchData() {
  const id = document.getElementById("tmdbid").value;
  if (!id) return alert("Enter TMDB ID!");

  const url = `https://api.themoviedb.org/3/movie/${id}?api_key=${TMDB_API_KEY}&append_to_response=credits,images,videos`;
  const res = await fetch(url);
  const data = await res.json();

  document.getElementById("title-field").value = data.title || "";
  document.getElementById("tagline-field").value = data.tagline || "";
  document.getElementById("poster-field").value = `https://image.tmdb.org/t/p/w500${data.poster_path}`;
  document.getElementById("backdrop-field").value = `https://image.tmdb.org/t/p/original${data.backdrop_path}`;
  document.getElementById("genres-field").value = data.genres.map(g => g.name).join(", ");
  document.getElementById("release-field").value = data.release_date || "";
  document.getElementById("runtime-field").value = data.runtime + " min" || "";
  document.getElementById("overview-field").value = data.overview || "";

  const cast = data.credits?.cast?.slice(0,5).map(a=>a.name).join(", ");
  document.getElementById("cast-field").value = cast || "";

  const crew = data.credits?.crew || [];
  const director = crew.find(c => c.job === "Director")?.name;
  const writer = crew.filter(c => c.job === "Writer").map(w => w.name).join(", ");
  document.getElementById("director-field").value = director || "";
  document.getElementById("writer-field").value = writer || "";

  const screenshots = data.images?.backdrops?.slice(0,5).map(i => `https://image.tmdb.org/t/p/w500${i.file_path}`);
  document.getElementById("screenshots-field").value = screenshots.join(", ");
}

function generateHTML() {
  const title = document.getElementById("title-field").value;
  const tagline = document.getElementById("tagline-field").value;
  const poster = document.getElementById("poster-field").value;
  const genres = document.getElementById("genres-field").value.split(",").map(g => g.trim());
  const release = document.getElementById("release-field").value;
  const runtime = document.getElementById("runtime-field").value;
  const director = document.getElementById("director-field").value;
  const writer = document.getElementById("writer-field").value;
  const cast = document.getElementById("cast-field").value;
  const overview = document.getElementById("overview-field").value;
  const screenshots = document.getElementById("screenshots-field").value.split(",").map(s=>s.trim());
  const dlLabel = document.getElementById("download-label-field").value;
  const dlLink = document.getElementById("download-link-field").value;

  const html = `
  <link rel="stylesheet" href="https://tituhh.github.io/css/cdn/gen.css">
  <div class="container">
    <div class="poster"><img src="${poster}" alt="${title} Poster"></div>
    <h1 class="title">${title}</h1>
    <p class="tagline">${tagline}</p>

    <div class="info-grid">
      <div><span class="label">Release Date:</span> <span class="value">${release}</span></div>
      <div><span class="label">Runtime:</span> <span class="value">${runtime}</span></div>
      <div><span class="label">Director:</span> <span class="value">${director}</span></div>
      <div><span class="label">Writer:</span> <span class="value">${writer}</span></div>
      <div><span class="label">Top Cast:</span> <span class="value">${cast}</span></div>
    </div>

    <div class="overview"><span class="label">Overview:</span><p>${overview}</p></div>

    <div class="screenshots"><h3>Screenshots</h3>
      <div class="gallery">
        ${screenshots.map(s => `<img src="${s}" alt="Screenshot">`).join("")}
      </div>
    </div>

    <a href="${dlLink}" class="download-btn">${dlLabel}</a>
  </div>`;

  document.getElementById("output").innerText = html;
  return html;
}

async function sendToBlogger() {
  const htmlContent = generateHTML();
  const title = document.getElementById("title-field").value;
  const genres = document.getElementById("genres-field").value.split(",").map(g=>g.trim());

  const res = await fetch("/api/sendPost", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      to: "asatkarsarvesh39.titu@blogger.com",
      title,
      genres,
      htmlContent
    })
  });

  const data = await res.json();
  alert(data.success ? "‚úÖ Sent to Blogger!" : "‚ùå Error: " + data.error);
}
</script>

</body>
</html>
